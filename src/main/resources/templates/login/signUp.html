<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>회원 가입</title>

</head>
<body class="gradient-custom">

                <h2 class="text-white">SIGN UP</h2>
                <p class="text-white-50 mt-2 mb-5">서비스 사용을 위한 회원 가입</p>

                <div>
                    <form th:action="@{/signup}" th:object="${userForm}" method="POST">
                        <div>
                            <input type="hidden" name="_csrf" th:value="${_csrf.token}">
                        </div>
                        <div>
                            <label for="userId">아이디</label>
                            <input type="text" id="userId" th:field="*{userId}"
                                   th:errorclass="field-error" class="form-control">
                            <button type="button" id="checkIdButton" onclick="checkIdExist()">중복확인</button>
                            <div id="checkResult"></div>
                            <div class="field-error" th:errors="*{userId}"></div>
                        </div>
                        <div>
                            <label for="userPassword">비밀번호</label>
                            <input type="password" id="userPassword" th:field="*{userPassword}"
                                   th:errorclass="field-error" class="form-control">
                            <div class="field-error" th:errors="*{userPassword}"></div>
                        </div>
<!--                        <div>
                            <label>비밀번호 확인</label>
                            <input type="password" name="userPassword">
                        </div>-->
                        <div>
                            <label for="userPhone">전화번호</label>
                            <input type="text" id="userPhone" th:field="*{userPhone}"
                                   th:errorclass="field-error" class="form-control">
                            <div class="field-error" th:errors="*{userPhone}"></div>
                        </div>
                        <div>
                            <label for="userEmail">이메일</label>
                            <input type="text" id="userEmail" th:field="*{userEmail}"
                                   th:errorclass="field-error" class="form-control">
                            <div class="field-error" th:errors="*{userEmail}"></div>
                        </div>
                        <div>
                            <label for="userNickname">닉네임(이름)</label>
                            <input type="text" id="userNickname" th:field="*{userNickname}"
                                   th:errorclass="field-error" class="form-control">
                            <div class="field-error" th:errors="*{userNickname}"></div>
                        </div>

                        <button type="submit" >회원가입</button>
                    </form>
                </div>
    <script>
        function checkIdExist() {
            const userId = document.querySelector('input[name=userId]').value;
            const regex = /^[a-z0-9]{10,30}$/;

            // 정규표현식 검증
            if (!regex.test(userId)) {
                document.getElementById('checkResult').innerText = '아이디는 10~30자 영문 소문자와 숫자만 사용 가능합니다.';
                return false;
            }
            const requestObject = { userId : userId };

            fetch('/checkid?' + new URLSearchParams(requestObject), {
                method : 'GET',
                headers: {
                    'Content-Type' : 'application/json'
                }
            })
                .then(response => response.text())
                .then(data => {
                    console.log(data)
                    document.getElementById('checkResult').innerText = data;
                })
                .catch(error => {
                    console.error('Error', error);
                    document.getElementById('checkResult').innerText = '오류가 발생했습니다';
                });

            return false;
        }
    </script>
</body>
</html>